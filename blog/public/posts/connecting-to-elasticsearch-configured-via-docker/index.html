<!DOCTYPE html>
<html><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Thoughts on code and building things.">
    
    <link rel="shortcut icon" href="http://localhost:1313/favicon.ico">
    <link href="http://localhost:1313/fontawesome/css/all.min.css" rel="stylesheet">

    <style>
#post-header {
    text-align: center;
}

main#content blockquote {
  margin-top: 10px;
    margin-bottom: 10px;
    margin-left: 50px;
    padding-left: 15px;
    border-left: 5px solid;
    display: inline-flex;
}
main#content p code {
    background: black;
    color: white;
    border-radius: 5px;
}
 
table {
padding: 1.5rem 2.2rem;
    margin: 20px 0;
    margin-left: -3.8%;
    box-sizing: border-box;
    overflow-x: auto;
}

 
table {
  color: #333;
  background: white;
  border: 1px solid grey;
  font-size: 12pt;
  border-collapse: collapse;
}
table thead th,
table tfoot th {
  color: #777;
  background: rgba(0,0,0,.1);
}
table caption {
  padding:.5em;
}
table th,
table td {
  padding: .5em;
  border: 1px solid lightgrey;
}
 
[data-table-theme*=zebra] tbody tr:nth-of-type(odd) {
  background: rgba(0,0,0,.05);
}
[data-table-theme*=zebra][data-table-theme*=dark] tbody tr:nth-of-type(odd) {
  background: rgba(255,255,255,.05);
}
 
[data-table-theme*=dark] {
  color: #ddd;
  background: #333;
  font-size: 12pt;
  border-collapse: collapse;
}
[data-table-theme*=dark] thead th,
[data-table-theme*=dark] tfoot th {
  color: #aaa;
  background: rgba(0255,255,255,.15);
}
[data-table-theme*=dark] caption {
  padding:.5em;
}
[data-table-theme*=dark] th,
[data-table-theme*=dark] td {
  padding: .5em;
  border: 1px solid grey;
}
    </style>

    
    <link rel="stylesheet" href="/css/style.min.css">

    <title>Connecting to Elasticsearch Configured via Docker</title>
    <script data-goatcounter="https://devtaqkarim.goatcounter.com/count"
        async src="//gc.zgo.at/count.js"></script>
    
    
    <script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "50d6391b0ac14e93bae2808292658be2"}'></script>
    
</head>
<body><header id="banner">
    
    <nav>
        <ul>
            <li>
                <a href="https://github.com/mottaquikarim" title="github" target="_blank"><i class='fab fa-github'></i></a>
            </li><li>
                <a href="https://www.linkedin.com/in/mottaqui-karim-5b01212a/" title="linkedin" target="_blank"><i class='fab fa-linkedin'></i></a>
            </li><li>
                <a href="https://twitter.com/taqkarim" title="twitter" target="_blank"><i class='fab fa-twitter'></i></a>
            </li>
        </ul>
    </nav>
    <nav>
        <ul>
            <li>
                <a href="/" title="home">home</a>
            </li><li>
                <a href="/about/" title="about">about</a>
            </li><li>
                <a href="/tags/" title="tags">tags</a>
            </li>
        </ul>
    </nav>
</header>
<main id="content">
<article>
    <small><strong>TAGS: </strong></small>
        
        
            <small><strong><a href="http://localhost:1313/tags/docker/">docker</a></strong></small>
        
            <small><strong><a href="http://localhost:1313/tags/elasticsearch/">elasticsearch</a></strong></small>
        <header id="post-header">
        <h1>Connecting to Elasticsearch Configured via Docker</h1><time>March 16, 2020</time></header><aside id="toc">
    <h4>Table of Contents</h4>
    <nav id="TableOfContents">
  <ul>
    <li><a href="#elastic-search-and-docker">Elastic Search and Docker</a></li>
    <li><a href="#gotchas">Gotchas</a>
      <ul>
        <li><a href="#windows-elasticsearch-doesnt-work">Windows: ElasticSearch doesn&rsquo;t work</a></li>
        <li><a href="#even-after-changes-above-not-working">Even after changes above, not working</a></li>
      </ul>
    </li>
  </ul>
</nav>
</aside>

<h2 id="elastic-search-and-docker">Elastic Search and Docker</h2>
<p>Setting up an elasticsearch + kibana runtime is very easy to do with docker-compose:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;3&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">services</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">elasticsearch</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">docker.elastic.co/elasticsearch/elasticsearch:6.3.2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">cluster.name=docker-cluster</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">bootstrap.memory_lock=true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s2">&#34;ES_JAVA_OPTS=-Xms512m -Xmx512m&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ulimits</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">memlock</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">soft</span><span class="p">:</span><span class="w"> </span>-<span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">hard</span><span class="p">:</span><span class="w"> </span>-<span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s2">&#34;9200:9200&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">kibana</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">docker.elastic.co/kibana/kibana:6.3.2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s2">&#34;5601:5601&#34;</span><span class="w">
</span></span></span></code></pre></div><p>For more information on the defaults (<code>ulimits</code> or <code>environment</code> variables, please see <a href="https://blog.k2datascience.com/running-elasticsearch-kibana-using-docker-5ff10ad017d0">this</a> post)</p>
<p>To run, you simply:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker-compose up -d
</span></span></code></pre></div><p>And then navigate over to http://localhost:9200 for elasticsearch or http://localhost:5601 for kibana.</p>
<h2 id="gotchas">Gotchas</h2>
<p>As with all things, there may be some gotchas associated with this setup. Specifically, you may notice that sometimes navigating to the URLs referenced above will result in connection errors.</p>
<p>This can be for quite a few reasons, I&rsquo;ll list some common ones I&rsquo;ve encountered below.</p>
<h3 id="windows-elasticsearch-doesnt-work">Windows: ElasticSearch doesn&rsquo;t work</h3>
<p>A few things to check - run a <code>docker ps -a</code> to ensure your container is running and for how long.</p>
<p>if it only lives for a few seconds, it may be due to a default <a href="https://stackoverflow.com/a/11685165"><code>max_map_count</code> issue</a>. To fix, if using <code>docker-machine</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker-machine ssh
</span></span><span class="line"><span class="cl">sudo sysctl -w vm.max_map_count<span class="o">=</span><span class="m">262144</span>
</span></span><span class="line"><span class="cl"><span class="nb">exit</span>
</span></span></code></pre></div><p>If <em>not</em> using <code>docker-machine</code>, try:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker <span class="nb">exec</span> -it &lt;container_id&gt; /bin/bash
</span></span><span class="line"><span class="cl">sysctl -w vm.max_map_count<span class="o">=</span><span class="m">262144</span>
</span></span></code></pre></div><p><em>NOTE</em>: this will not persist after container is killed. TO make it &ldquo;permanent&rdquo; you might want to:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">vi /etc/sysctl.conf
</span></span><span class="line"><span class="cl">vm.max_map_count<span class="o">=</span><span class="m">262144</span>
</span></span></code></pre></div><p>(press <code>:q</code> to exit)</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">vi /etc/rc.local
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="m">262144</span> &gt; /proc/sys/vm/max_map_count
</span></span></code></pre></div><p><a href="https://stackoverflow.com/a/53047291"><em>source</em></a></p>
<h3 id="even-after-changes-above-not-working">Even after changes above, not working</h3>
<p>One bit to note is that the docker container is simply wrapping the elasticsearch service. As such, sometimes it just takes a bit of time to load.</p>
<p>To ensure that elasticsearch is running properly, consider running:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker-compose logs elasticsearch
</span></span></code></pre></div><p>This will display the log messages emitted as elasticsearch is booted inside your container.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">example_elasticsearch <span class="p">|</span> <span class="o">[</span>2020-03-16T05:32:12,704<span class="o">][</span>INFO <span class="o">][</span>o.e.n.Node               <span class="o">]</span> <span class="o">[</span>IzFG4tZ<span class="o">]</span> initialized
</span></span><span class="line"><span class="cl">example_elasticsearch <span class="p">|</span> <span class="o">[</span>2020-03-16T05:32:12,704<span class="o">][</span>INFO <span class="o">][</span>o.e.n.Node               <span class="o">]</span> <span class="o">[</span>IzFG4tZ<span class="o">]</span> starting ...
</span></span><span class="line"><span class="cl">example_elasticsearch <span class="p">|</span> <span class="o">[</span>2020-03-16T05:32:12,959<span class="o">][</span>INFO <span class="o">][</span>o.e.t.TransportService   <span class="o">]</span> <span class="o">[</span>IzFG4tZ<span class="o">]</span> publish_address <span class="o">{</span>172.18.0.2:9300<span class="o">}</span>, bound_addresses <span class="o">{</span>0.0.0.0:9300<span class="o">}</span>
</span></span></code></pre></div><p>Once you see those three lines, you <em>should</em> be safe to attempt your &ldquo;healthcheck&rdquo; such as visiting <code>http://localhost:9200</code> in the browser or curling for it.</p>
<p>Alternatively, if something is foobar&rsquo;d you&rsquo;ll see it here which gives you further clues as to what went wrong.</p>
<!-- testing -->

	    <h2>Share</h2>
        <a href="https://twitter.com/intent/tweet?original_referer=http%3a%2f%2flocalhost%3a1313%2fposts%2fconnecting-to-elasticsearch-configured-via-docker%2f?utm_source=twitter&text=Check out this article by @taqkarim: http%3a%2f%2flocalhost%3a1313%2fposts%2fconnecting-to-elasticsearch-configured-via-docker%2f?utm_source=twitter" target="_blank"><i class="fab fa-twitter fa-2x"></i></a>
        <a href="https://www.linkedin.com/shareArticle?mini=false&url=http%3a%2f%2flocalhost%3a1313%2fposts%2fconnecting-to-elasticsearch-configured-via-docker%2f?utm_source=linkedin" target="_blank"><i class="fab fa-linkedin fa-2x"></i></a>
        <a href="https://www.reddit.com/submit?url=http%3A%2F%2Flocalhost%3A1313%2Fposts%2Fconnecting-to-elasticsearch-configured-via-docker%2F%3Futm_source%3Dreddit&title=Connecting&#43;to&#43;Elasticsearch&#43;Configured&#43;via&#43;Docker" target="_blank" rel="noopener">
          <i class="fab fa-reddit fa-2x"></i>
        </a>
</article>

        </main><footer id="footer">
    Copyright Â© 2022 Taq Karim
</footer>
</body>
</html>
